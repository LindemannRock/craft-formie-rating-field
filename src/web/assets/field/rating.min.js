if(console.log("[FormieRating] Script loaded!"),console.log("[FormieRating] Window.Formie exists?",void 0!==window.Formie),window.FormieRating=class{constructor(e={}){console.log("[FormieRating] Constructor called with settings:",e),this.$form=e.$form,this.form=this.$form?this.$form.form:null,this.$field=e.$field,this.settings=e.settings||{},this.initializeField(),this.form&&this.$form&&this.form.addEventListener(this.$form,"onAfterFormieSubmit",this.onAfterSubmit.bind(this))}initializeField(){console.log("[FormieRating] initializeField called"),console.log("[FormieRating] $field:",this.$field);const e=this.$field.querySelector("select[data-rating]");if(console.log("[FormieRating] Found select element:",e),e)if(e.dataset.ratingInitialized)console.log("[FormieRating] Skipping - already initialized");else try{this.createRatingInterface(e),e.dataset.ratingInitialized="true"}catch(e){console.error("[FormieRating] Error creating rating interface:",e),console.error("[FormieRating] this:",this),console.error("[FormieRating] this.createStarItem:",this.createStarItem)}else console.warn("[FormieRating] No select element found with data-rating attribute in field:",this.$field)}createRatingInterface(e){const t=e.dataset.rating||this.settings.ratingType||"star",i=e.dataset.ratingSize||this.settings.ratingSize||"medium",n="true"===e.dataset.ratingShowSelected||this.settings.showSelectedLabel,a="true"===e.dataset.ratingShowEndpoints||this.settings.showEndpointLabels,s=e.dataset.ratingStartLabel||"",o=e.dataset.ratingEndLabel||"",r="true"===e.dataset.singleSelection||this.settings.singleEmojiSelection,l=e.dataset.customLabels?JSON.parse(e.dataset.customLabels):{},d=e.dataset.emojiMode||"system",c=document.createElement("div");if(c.className=`fui-rating-field fui-rating-${t} fui-rating-size-${i}`,"emoji"===t&&"system"!==d&&c.classList.add(`fui-rating-emoji-${d}`),c.dataset.singleSelection=r,c.dataset.customLabels=JSON.stringify(l),"star"===t){const t=document.createElement("div");t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.overflow="hidden",t.innerHTML=`\n                    <svg width="0" height="0">\n                        <defs>\n                            <linearGradient id="half-star-gradient-${e.id}">\n                                <stop offset="50%" stop-color="#f59e0b"/>\n                                <stop offset="50%" stop-color="#e5e7eb"/>\n                            </linearGradient>\n                        </defs>\n                    </svg>\n                `,c.appendChild(t)}const u=document.createElement("div");u.className="fui-rating-visual";const m=Array.from(e.options).filter(e=>e.value);if("star"===t){if(m.some(e=>e.value.includes(".5"))){const t=Math.max(...m.map(e=>Math.ceil(parseFloat(e.value)))),i="rtl"===document.documentElement.dir||"rtl"===document.body.dir,n=[];for(let e=1;e<=t;e++)n.push(e);i&&n.reverse(),n.forEach(t=>{const i=this.createStarItem(t);i.addEventListener("click",n=>{const a=i.getBoundingClientRect(),s=n.clientX-a.left,o="rtl"===document.documentElement.dir||"rtl"===document.body.dir?s>a.width/2:s<a.width/2;let r=t;o&&m.some(e=>e.value===(t-.5).toString())&&(r=t-.5),this.selectRating(e,r,c,i)}),i.addEventListener("mousemove",e=>{const n=i.getBoundingClientRect(),a=e.clientX-n.left,s=("rtl"===document.documentElement.dir||"rtl"===document.body.dir?a>n.width/2:a<n.width/2)&&m.some(e=>e.value===(t-.5).toString())?t-.5:t;this.updateVisualState(c,s)}),u.appendChild(i)})}else{("rtl"===document.documentElement.dir||"rtl"===document.body.dir?[...m].reverse():m).forEach(t=>{const i=parseFloat(t.value),n=this.createStarItem(i);n.addEventListener("click",()=>{this.selectRating(e,t.value,c,n)}),u.appendChild(n)})}}else{(!("rtl"===document.documentElement.dir||"rtl"===document.body.dir)||"nps"!==t&&"emoji"!==t?m:[...m].reverse()).forEach((i,n)=>{const a=m.indexOf(i),s=this.createRatingItem(t,i.value,i.text,a,m);s.addEventListener("click",()=>{this.selectRating(e,i.value,c,s)}),u.appendChild(s)})}if(c.appendChild(u),c.addEventListener("mouseleave",()=>{const t=e.value?parseFloat(e.value):null;this.updateVisualState(c,t)}),a&&(s||o)){const e=document.createElement("div");e.className="fui-rating-endpoints";"rtl"===document.documentElement.dir||document.body.dir;if(s){const t=document.createElement("span");t.className="fui-rating-start-label",t.textContent=s,e.appendChild(t)}if(o){const t=document.createElement("span");t.className="fui-rating-end-label",t.textContent=o,e.appendChild(t)}c.appendChild(e)}if(n||"emoji"===t&&r){const e=document.createElement("div");e.className="fui-rating-selected-label",c.appendChild(e)}e.parentNode.insertBefore(c,e),e.value&&this.selectRating(e,e.value,c),c.setAttribute("tabindex","0"),c.setAttribute("role","radiogroup"),c.setAttribute("aria-label",e.getAttribute("aria-label")||"Rating"),c.addEventListener("keydown",t=>{this.handleKeyboardNavigation(t,e,m,c)})}createStarItem(e){const t=document.createElement("button");return t.type="button",t.className="fui-rating-item fui-rating-star-item",t.setAttribute("data-value",e),t.setAttribute("role","radio"),t.setAttribute("aria-label",`${e} stars`),t.innerHTML='\n                <div class="star-container">\n                    <svg class="star-background" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"\n                              stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>\n                    </svg>\n                    <div class="star-fill">\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"\n                                  stroke="currentColor" stroke-width="2" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n                        </svg>\n                    </div>\n                </div>\n            ',t}createRatingItem(e,t,i,n,a){const s=document.createElement("button");if(s.type="button",s.className="fui-rating-item",s.setAttribute("data-value",t),s.setAttribute("role","radio"),s.setAttribute("aria-label",i),a&&a.length>1){const e=parseFloat(a[0].value),i=parseFloat(a[a.length-1].value),n=(parseFloat(t)-e)/(i-e)*100;s.setAttribute("data-position",Math.round(n))}switch(e){case"star":s.innerHTML='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';break;case"emoji":const e=["ðŸ˜¢","ðŸ˜•","ðŸ˜","ðŸ˜Š","ðŸ˜"],i=["ðŸ˜¢","ðŸ˜•","ðŸ˜","ðŸ˜Š","ðŸ˜","ðŸ¤©","ðŸ¥°","ðŸ˜Ž"],o=["ðŸ˜­","ðŸ˜¢","ðŸ˜•","ðŸ˜","ðŸ˜Š","ðŸ˜","ðŸ¤©","ðŸ¥°","ðŸ˜Ž","ðŸ¤—","ðŸ¥³"];let r;if(a&&a.length>0){const n=a.length;r=n<=5?e:n<=8?i:o;const l=parseFloat(a[0].value),d=parseFloat(a[a.length-1].value),c=Math.round((parseFloat(t)-l)/(d-l)*(r.length-1));s.textContent=r[Math.min(Math.max(0,c),r.length-1)]}else r=o,s.textContent=r[Math.min(n,r.length-1)];break;case"nps":s.textContent=t,s.classList.add("fui-rating-nps-item")}return s}selectRating(e,t,i,n){e.value=t;const a=new Event("change",{bubbles:!0});e.dispatchEvent(a),this.updateVisualState(i,t);const s=i.querySelector(".fui-rating-selected-label");if(s){const i=e.querySelector(`option[value="${t}"]`);s.textContent=i?i.text:""}}updateVisualState(e,t){const i=e.classList.contains("fui-rating-emoji")?"emoji":e.classList.contains("fui-rating-nps")?"nps":"star";if(null!=t&&""!==t)if("star"===i)e.querySelectorAll(".fui-rating-item").forEach(e=>{const i=parseFloat(e.getAttribute("data-value")),n=e.querySelector(".star-fill");if(n)if(e.classList.remove("fui-rating-selected"),i<=Math.floor(t))n.style.clipPath="none",n.style.opacity="1",e.classList.add("fui-rating-selected");else if(i-.5===t){const t="rtl"===document.documentElement.dir||"rtl"===document.body.dir;n.style.clipPath=t?"inset(0 0 0 50%)":"inset(0 50% 0 0)",n.style.opacity="1",e.classList.add("fui-rating-selected")}else n.style.opacity="0"});else{const n="true"===e.dataset.singleSelection&&"emoji"===i;e.querySelectorAll(".fui-rating-item").forEach(e=>{const i=parseFloat(e.getAttribute("data-value"));e.classList.remove("fui-rating-selected"),n?i===t&&e.classList.add("fui-rating-selected"):i<=t&&e.classList.add("fui-rating-selected"),e.setAttribute("aria-checked",i===t?"true":"false")})}else"star"===i?e.querySelectorAll(".star-fill").forEach(e=>{e.style.opacity="0"}):e.querySelectorAll(".fui-rating-item").forEach(e=>{e.classList.remove("fui-rating-selected"),e.setAttribute("aria-checked","false")})}handleKeyboardNavigation(e,t,i,n){const a=parseFloat(t.value);let s=-1;const o=i.findIndex(e=>parseFloat(e.value)===a);switch(e.key){case"ArrowLeft":case"ArrowDown":e.preventDefault(),s=Math.max(0,o-1);break;case"ArrowRight":case"ArrowUp":e.preventDefault(),s=Math.min(i.length-1,o+1);break;case"Home":e.preventDefault(),s=0;break;case"End":e.preventDefault(),s=i.length-1}s>=0&&s<i.length&&this.selectRating(t,i[s].value,n)}onAfterSubmit(){}},console.log("[FormieRating] Class defined on window:",typeof window.FormieRating),console.log("[FormieRating] Waiting for Formie to instantiate..."),window.Formie){console.log("[FormieRating] Formie object:",window.Formie);const e=()=>{console.log("[FormieRating] Initializing rating fields...");const e=document.querySelectorAll("[data-fui-form]");console.log("[FormieRating] Found forms:",e.length),e.forEach(e=>{const t=e.querySelectorAll("select[data-rating]");console.log("[FormieRating] Found rating select elements in form:",t.length),t.forEach(t=>{if(t.dataset.ratingInitialized)return;const i=window.Formie?window.Formie.forms.find(t=>t.$form===e):null,n={$form:e,form:i,$field:t.parentElement,settings:{}};console.log("[FormieRating] Manually initializing select:",t),new window.FormieRating(n)})})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):setTimeout(e,100)}