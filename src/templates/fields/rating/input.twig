{# Register the CSS asset for front-end #}
{% do craft.app.getView().registerAssetBundle('\\lindemannrock\\formieratingfield\\web\\assets\\field\\RatingFieldAsset') %}

{# Check emoji render mode setting and load web font if needed #}
{% set plugin = craft.app.plugins.getPlugin('formie-rating-field') %}
{% if plugin %}
    {% set emojiMode = plugin.settings.emojiRenderMode ?? 'system' %}

    {# Handle backward compatibility: 'webfont' maps to 'noto-color' #}
    {% if emojiMode == 'webfont' %}
        {% set emojiMode = 'noto-color' %}
    {% endif %}

    {% if emojiMode == 'noto-color' %}
        {# Load Noto Color Emoji from Google Fonts #}
        {% do craft.app.getView().registerCssFile('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap', {
            position: constant('yii\\web\\View::POS_HEAD')
        }) %}

        {# Add class to enable webfont styles #}
        {% do craft.app.getView().registerJs("document.documentElement.classList.add('fui-rating-emoji-noto-color');", constant('yii\\web\\View::POS_READY')) %}
    {% elseif emojiMode == 'noto-simple' %}
        {# Load Noto Emoji (simple style) from Google Fonts #}
        {% do craft.app.getView().registerCssFile('https://fonts.googleapis.com/css2?family=Noto+Emoji&display=swap', {
            position: constant('yii\\web\\View::POS_HEAD')
        }) %}

        {# Add class to enable webfont styles #}
        {% do craft.app.getView().registerJs("document.documentElement.classList.add('fui-rating-emoji-noto-simple');", constant('yii\\web\\View::POS_READY')) %}
    {% endif %}
{% endif %}

{# Set default variables if not provided #}
{% set name = name ?? field.handle %}
{% set value = value ?? field.defaultValue ?? null %}
{% set options = field.getRatingOptions() %}
{% set selectedLabel = '' %}
{% for option in options %}
	{% if option.value == value %}
		{% set selectedLabel = option.label matches '/^[0-9.]+$/' ? option.label : option.label|t('formie') %}
	{% endif %}
{% endfor %}

<select name="{{ field.getHtmlName() }}" id="{{ field.getHtmlId(form) }}" class="fui-select" data-rating="{{ field.ratingType }}" data-rating-size="{{ field.ratingSize }}" {% if field.showSelectedLabel %} data-rating-show-selected="true" {% endif %} {% if field.showEndpointLabels %} data-rating-show-endpoints="true" {% if field.startLabel %} data-rating-start-label="{{ field.startLabel }}" {% endif %} {% if field.endLabel %} data-rating-end-label="{{ field.endLabel }}" {% endif %} {% endif %} {% if field.required %} required aria-required="true" {% endif %} data-field-config="{{ field.getConfigJson() }}" data-formie-rating-field="true">
	<option value="">{{ field.placeholder ?? 'Choose a rating'|t('formie') }}</option>
	{% for option in options %}
		<option value="{{ option.value }}" {% if value is not null and option.value == value %} selected {% endif %}>
			{% if option.label matches '/^[0-9.]+$/' %}{{ option.label }}{% else %}{{ option.label|t('formie') }}{% endif %}
		</option>
	{% endfor %}
</select>
